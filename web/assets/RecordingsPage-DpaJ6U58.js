import{p as e,C as s,s as t,x as a,m as i,D as r,l as n,k as l,c,i as o,f as d,n as v,v as u,z as f,R as j,e as g,j as b,y as p,G as h,a3 as m,t as x,A as y,o as w,g as k,u as _,K as z,r as P,q as $,F as R,J as S,b as L,H as A,_ as C,U}from"./svelte-0sMdcN14.js";import{r as D}from"./recordings-DKASnGSb.js";import{S as T,j as B,l as F}from"./index-Be2XYons.js";import"./vendor-CPGM4lnp.js";var M=d('<button class="action-btn svelte-1fsdjjx" title="Copy share link"><!></button>'),N=d('<button class="ctrl-btn svelte-1fsdjjx"><!></button> <button class="ctrl-btn svelte-1fsdjjx" title="Stop"><!></button>',1),J=d('<button class="ctrl-btn primary svelte-1fsdjjx" title="Play"><!></button>'),O=d('<div class="player-section svelte-1fsdjjx"><div class="player-header svelte-1fsdjjx"><button class="back-btn svelte-1fsdjjx"><!> Back to list</button> <div class="player-info svelte-1fsdjjx"><h2 class="svelte-1fsdjjx"> </h2> <span class="meta svelte-1fsdjjx"> </span></div> <div class="player-actions svelte-1fsdjjx"><button class="action-btn svelte-1fsdjjx" title="Download"><!></button> <!></div></div> <div class="player-container svelte-1fsdjjx"></div> <div class="player-controls svelte-1fsdjjx"><div class="progress-bar svelte-1fsdjjx"><div class="progress-fill svelte-1fsdjjx"></div></div> <div class="control-buttons svelte-1fsdjjx"><!></div></div></div>'),q=d('<div class="loading svelte-1fsdjjx"><div class="spinner svelte-1fsdjjx"></div> <span>Loading recordings...</span></div>'),E=d('<div class="empty-state svelte-1fsdjjx"><!> <h3 class="svelte-1fsdjjx"> </h3> <p class="svelte-1fsdjjx"> </p></div>'),G=d('<button class="icon-btn svelte-1fsdjjx" title="Copy link"><!></button>'),H=d('<div class="recording-card svelte-1fsdjjx"><div class="card-header svelte-1fsdjjx"><div class="rec-icon svelte-1fsdjjx"><!></div> <div class="rec-info svelte-1fsdjjx"><h3 class="svelte-1fsdjjx"> </h3> <span class="meta svelte-1fsdjjx"> </span></div></div> <div class="card-actions svelte-1fsdjjx"><button><!></button> <!> <button class="icon-btn svelte-1fsdjjx" title="Download"><!></button> <button class="icon-btn delete svelte-1fsdjjx" title="Delete"><!></button></div></div>'),I=d('<div class="recordings-grid svelte-1fsdjjx"><!></div>'),K=d('<div class="recordings-page svelte-1fsdjjx"><div class="page-header svelte-1fsdjjx"><div class="header-content svelte-1fsdjjx"><h1 class="svelte-1fsdjjx"><!> Recordings</h1> <p class="subtitle svelte-1fsdjjx">View and manage your terminal session recordings</p></div> <div class="search-box svelte-1fsdjjx"><!> <input type="text" placeholder="Search recordings..." class="svelte-1fsdjjx"/></div></div> <!></div>');function V(d,$){e($,!1);const V=()=>a(D,"$recordings",Q),[Q,W]=p(),X=i();let Y=i([]),Z=i(!0),ee=i(null),se=i(),te=null,ae=null,ie=i(!1),re=i(!1),ne=i(0),le=null,ce=[],oe=0,de=i("");function ve(){0!==ce.length&&(t(ie,!0),t(re,!1),ue())}function ue(){if(l(re)||oe>=ce.length)return void(oe>=ce.length&&(t(ie,!1),t(ne,100)));const e=ce[oe],[s,a,i]=e;"o"===a&&te&&te.write(i);const r=ce[ce.length-1][0];if(t(ne,s/r*100),oe++,oe<ce.length){const e=ce[oe][0],t=Math.max(10,1e3*(e-s));le=setTimeout(ue,t)}else t(ie,!1),t(ne,100)}function fe(){l(re)?(t(re,!1),ue()):(t(re,!0),le&&clearTimeout(le))}function je(){if(le&&(clearTimeout(le),le=null),t(ie,!1),t(re,!1),oe=0,t(ne,0),te&&te.element)try{te.clear(),te.reset()}catch(e){}}function ge(){if(je(),te&&te.element)try{te.clear(),te.reset()}catch(e){}oe=0,t(ne,0),ve()}function be(){je(),t(ee,null)}function pe(e){if(!e)return;const s=`${window.location.origin}${e.shareUrl}`;navigator.clipboard.writeText(s)}async function he(e){if(e)try{const s=k(B),t=await fetch(`/api/recordings/${e.id}/stream`,{headers:{Authorization:`Bearer ${s}`}});if(t.ok){const s=await t.blob(),a=window.URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download=`${e.title||"recording"}.cast`,document.body.appendChild(i),i.click(),window.URL.revokeObjectURL(a),i.remove()}}catch(s){}}function me(e){return new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}s(async()=>{await D.fetchRecordings(),t(Y,V().recordings),t(Z,!1)}),r(()=>{je(),te&&te.dispose()}),n(()=>(l(Y),l(de)),()=>{t(X,l(Y).filter(e=>!l(de)||e.title?.toLowerCase().includes(l(de).toLowerCase())||e.containerName?.toLowerCase().includes(l(de).toLowerCase())))}),c(),o();var xe=K(),ye=v(xe),we=v(ye),ke=v(we),_e=v(ke);T(_e,{status:"recording",size:28});var ze=f(we,2),Pe=v(ze);T(Pe,{status:"search",size:16});var $e=f(Pe,2),Re=f(ye,2),Se=e=>{var s=O(),a=v(s),i=v(a);i.__click=be;var r=v(i);T(r,{status:"back",size:16});var n=f(i,2),c=v(n),o=v(c),d=f(c,2),j=v(d),b=f(n,2),p=v(b);p.__click=()=>he(l(ee));var k=v(p);T(k,{status:"download",size:16});var P=f(p,2),$=e=>{var s=M();s.__click=()=>pe(l(ee));var t=v(s);T(t,{status:"link",size:16}),g(e,s)};u(P,e=>{l(ee),h(()=>l(ee).isPublic)&&e($)});var S=f(a,2);m(S,e=>t(se,e),()=>l(se));var L=f(S,2),A=v(L),C=v(A),U=f(A,2),D=v(U),B=e=>{var s=N(),t=_(s);t.__click=fe;var a=v(t);{let e=z(()=>l(re)?"play":"validating");T(a,{get status(){return l(e)},size:18})}var i=f(t,2);i.__click=je;var r=v(i);T(r,{status:"close",size:18}),x(()=>R(t,"title",l(re)?"Resume":"Pause")),g(e,s)},F=e=>{var s=J();s.__click=ge;var t=v(s);T(t,{status:"play",size:18}),g(e,s)};u(D,e=>{l(ie)?e(B):e(F,!1)}),x(e=>{y(o,(l(ee),h(()=>l(ee).title||"Untitled Recording"))),y(j,`${e??""} · ${l(ee),h(()=>l(ee).duration)??""}`),w(C,`width: ${l(ne)??""}%`)},[()=>(l(ee),h(()=>me(l(ee).createdAt)))]),g(e,s)},Le=e=>{var s=I(),a=v(s),i=e=>{var s=q();g(e,s)},r=e=>{var s=P(),a=_(s),i=e=>{var s=E(),t=v(s);T(t,{status:"recording",size:48});var a=f(t,2),i=v(a),r=f(a,2),n=v(r);x(()=>{y(i,l(de)?"No matching recordings":"No recordings yet"),y(n,l(de)?"Try a different search term":"Start a recording from any terminal session")}),g(e,s)},r=e=>{var s=P(),a=_(s);S(a,1,()=>l(X),C,(e,s)=>{var a=H(),i=v(a);i.__click=()=>async function(e){if(t(ee,e),t(ie,!1),t(re,!1),t(ne,0),oe=0,ce=[],await U(),await new Promise(e=>setTimeout(e,50)),l(se)){if(!te){let e,t;try{({Terminal:e,FitAddon:t}=await F())}catch(s){return}te=new e({theme:{background:"#0a0a14",foreground:"#e0e0e0",cursor:"#00ff88",black:"#1a1a2e",red:"#ff6b6b",green:"#00ff88",yellow:"#ffd93d",blue:"#6c5ce7",magenta:"#a29bfe",cyan:"#00d4ff",white:"#e0e0e0"},fontSize:13,fontFamily:"'JetBrains Mono', 'Fira Code', monospace",cursorStyle:"block",cursorBlink:!1,scrollback:5e3}),ae=new t,te.loadAddon(ae),te.open(l(se)),ae.fit()}if(te&&te.element)try{te.clear(),te.reset()}catch(s){}try{const t=k(B),a=await fetch(`/api/recordings/${e.id}/stream`,{headers:{Authorization:`Bearer ${t||localStorage.getItem("token")}`}});if(a.ok){const e=(await a.text()).trim().split("\n");for(let t=1;t<e.length;t++)try{const s=JSON.parse(e[t]);Array.isArray(s)&&s.length>=3&&ce.push(s)}catch(s){}ce.length>0&&ve()}}catch(s){}}}(l(s));var r=v(i),n=v(r);T(n,{status:"recording",size:20});var c=f(r,2),o=v(c),d=v(o),j=f(o,2),b=v(j),p=f(i,2),m=v(p);let w;m.__click=e=>{e.stopPropagation(),async function(e){await D.updateRecording(e.id,{isPublic:!e.isPublic}),t(Y,V().recordings)}(l(s))};var _=v(m);{let e=z(()=>(l(s),h(()=>l(s).isPublic?"globe":"lock")));T(_,{get status(){return l(e)},size:14})}var P=f(m,2),$=e=>{var t=G();t.__click=e=>{e.stopPropagation(),pe(l(s))};var a=v(t);T(a,{status:"link",size:14}),g(e,t)};u(P,e=>{l(s),h(()=>l(s).isPublic)&&e($)});var S=f(P,2);S.__click=e=>{e.stopPropagation(),he(l(s))};var C=v(S);T(C,{status:"download",size:14});var M=f(S,2);M.__click=e=>{e.stopPropagation(),async function(e){confirm("Delete this recording permanently?")&&(await D.deleteRecording(e.id),t(Y,V().recordings),l(ee)?.id===e.id&&be())}(l(s))};var N=v(M);T(N,{status:"trash",size:14}),x((e,t)=>{y(d,(l(s),h(()=>l(s).title||"Untitled"))),y(b,`${e??""} · ${l(s),h(()=>l(s).duration)??""} · ${t??""}`),w=A(m,1,"icon-btn svelte-1fsdjjx",null,w,{active:l(s).isPublic}),R(m,"title",(l(s),h(()=>l(s).isPublic?"Make private":"Make public")))},[()=>(l(s),h(()=>me(l(s).createdAt))),()=>(L(D),l(s),h(()=>D.formatSize(l(s).sizeBytes)))]),g(e,a)}),g(e,s)};u(a,e=>{l(X),h(()=>0===l(X).length)?e(i):e(r,!1)},!0),g(e,s)};u(a,e=>{l(Z)?e(i):e(r,!1)}),g(e,s)};u(Re,e=>{l(ee)?e(Se):e(Le,!1)}),j($e,()=>l(de),e=>t(de,e)),g(d,xe),b(),W()}$(["click"]);export{V as default};
